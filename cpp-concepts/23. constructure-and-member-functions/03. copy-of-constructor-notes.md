# Constructors and Member Functions

## Copy Constructor in C++

* **Definition:**
  A copy constructor is a special constructor used to **create a new object using an existing object** of the same class.

* **Compiler-Generated Default Copy Constructor:**

  * Performs **shallow copy** (copies pointer values, not the objects they point to).
  * Works fine for basic types but fails for classes with dynamic memory or resources.

---

### **Default Copy Constructor Example**

```cpp
#include <iostream>
using namespace std;

class A {
public:
    int x;
};

int main() {
    A a1;
    a1.x = 10;
    cout << "a1's x = " << a1.x << endl;

    A a2(a1);  // Default copy constructor
    cout << "a2's x = " << a2.x;

    return 0;
}
```

**Output:**

```
a1's x = 10
a2's x = 10
```

---

### **User-Defined Copy Constructor**

* **Syntax:**

```cpp
ClassName (const ClassName &obj) {
    // Copy object's members
}
```

* `const` prevents modification of the source object.
* Copies members to create a **deep copy** if needed.

---

### **Example: User-Defined Copy Constructor**

```cpp
#include <iostream>
using namespace std;

class A {
public:
    int x;
    A() {};

    // Copy Constructor
    A(A &obj) {
        x = obj.x;
        cout << "Copy constructor called" << endl;
    }
};

int main() {
    A obj1;
    obj1.x = 10;
    cout << "obj1's x = " << obj1.x << endl;

    A obj2(obj1);  // User-defined copy constructor called
    cout << "obj2's x = " << obj2.x;

    return 0;
}
```

**Output:**

```
obj1's x = 10
Copy constructor called
obj2's x = 10
```

---

### **Need for User-Defined Copy Constructor**

* Default copy constructor does a **shallow copy**.
* Shallow copy causes issues if class has **dynamic memory, file handles, or network connections**.
* Deep copy ensures each object gets its **own copy of dynamic resources**.

---

### **Example: Deep Copy**

```cpp
#include <bits/stdc++.h>
using namespace std;

class String {
private:
    char *s;
    int size;

public:
    String(const char *str) {
        size = strlen(str);
        s = new char[size + 1];
        strcpy(s, str);
    }
    ~String() { delete[] s; }

    // Copy Constructor for deep copy
    String(const String &old_str) {
        size = old_str.size;
        s = new char[size + 1];
        strcpy(s, old_str.s);
    }

    void print() { cout << s << endl; }

    void change(const char *str) {
        delete[] s;
        size = strlen(str);
        s = new char[size + 1];
        strcpy(s, str);
    }
};

int main() {
    String str1("GeeksQuiz");

    String str2 = str1;  // Copy constructor called
    str1.print();
    str2.print();

    str2.change("GeeksforGeeks");
    str1.print();
    str2.print();

    return 0;
}
```

**Output:**

```
GeeksQuiz
GeeksQuiz
GeeksQuiz
GeeksforGeeks
```

* **Without a custom copy constructor:** `str1` and `str2` would share memory, causing unexpected behavior.

---

### **When is the Copy Constructor Called?**

1. Object is returned **by value** from a function.
2. Object is passed **by value** to a function.
3. Object is constructed **from another object** of the same class.
4. Compiler generates a temporary object.

> **Note:** Copy may be optimized away (Copy Elision / RVO).

---

### **Copy Constructor vs Assignment Operator**

```cpp
MyClass t1, t2;
MyClass t3 = t1;  // Copy constructor
t2 = t1;           // Assignment operator
```

* **Copy constructor:** Called when a new object is **created as a copy**.
* **Assignment operator:** Called when an **existing object is assigned** a new value.

---