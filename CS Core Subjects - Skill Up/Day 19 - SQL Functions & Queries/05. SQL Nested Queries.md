# **SQL Nested Queries / Subqueries**

A **nested query** is a **query inside another SQL query**. The **inner query executes first**, and its result is used by the **outer query**. Nested queries make SQL operations **structured, readable, and maintainable**.

**Where nested queries can appear:**

* `SELECT` clause
* `FROM` clause
* `WHERE` clause

**Why use nested queries?**

* **Filter data dynamically** based on other queries.
* **Aggregate or compare** data across tables.
* **Simplify complex queries** instead of multiple separate queries.

---

## **1. Types of Nested Queries**

### **1a. Independent Nested Query**

* Inner query **does not depend on outer query**.
* Inner query executes first.
* Often used with `IN`, `NOT IN`, `ANY`, `ALL`.

**Example:** Students enrolled in `'DSA'` or `'DBMS'`

```sql
SELECT S_ID 
FROM STUDENT_COURSE 
WHERE C_ID IN (
    SELECT C_ID 
    FROM COURSE 
    WHERE C_NAME IN ('DSA', 'DBMS')
);
```

**Logic:**

1. Inner query finds IDs of `'DSA'` and `'DBMS'` courses.
2. Outer query finds students enrolled in those courses.

---

### **1b. Correlated Nested Query**

* Inner query **depends on outer query**.
* Executed **once for each row** of the outer query.
* Often used with `EXISTS`.

**Example:** Students enrolled in course `C1`

```sql
SELECT S_NAME 
FROM STUDENT S
WHERE EXISTS (
    SELECT 1 
    FROM STUDENT_COURSE SC
    WHERE S.S_ID = SC.S_ID AND SC.C_ID = 'C1'
);
```

**Logic:**

* For each student, check if they are enrolled in `C1`.
* If yes, include the student in the result.

---

## **2. Common Operators in Nested Queries**

### **2a. IN**

* Checks if a value exists in a list of values returned by a subquery.

```sql
SELECT S_NAME 
FROM STUDENT
WHERE S_ID IN (
    SELECT S_ID 
    FROM STUDENT_COURSE
    WHERE C_ID IN (
        SELECT C_ID 
        FROM COURSE 
        WHERE C_NAME IN ('DSA', 'DBMS')
    )
);
```

**Output:** Students in `'DSA'` or `'DBMS'`

---

### **2b. NOT IN**

* Excludes values returned by a subquery.

```sql
SELECT S_ID 
FROM STUDENT
WHERE S_ID NOT IN (
    SELECT S_ID 
    FROM STUDENT_COURSE
    WHERE C_ID IN (
        SELECT C_ID 
        FROM COURSE 
        WHERE C_NAME IN ('DSA', 'DBMS')
    )
);
```

**Output:** Students **not enrolled** in `'DSA'` or `'DBMS'`.

---

### **2c. ANY**

* Compares a value to **any value returned** by a subquery.
* True if **at least one comparison succeeds**.

```sql
SELECT S_NAME 
FROM STUDENT
WHERE S_AGE > ANY (
    SELECT S_AGE 
    FROM STUDENT 
    WHERE S_ADDRESS = 'DELHI'
);
```

**Logic:** Returns students whose age is greater than **at least one student from Delhi**.

---

### **2d. ALL**

* Compares a value to **all values returned** by a subquery.
* True only if condition holds for **every value**.

```sql
SELECT S_NAME 
FROM STUDENT
WHERE S_AGE > ALL (
    SELECT S_AGE 
    FROM STUDENT 
    WHERE S_ADDRESS = 'DELHI'
);
```

**Logic:** Returns students whose age is greater than **all students from Delhi**.

**Output:** No rows, because no student is older than all Delhi students.

---

## **3. Nested Queries Summary**

| Type        | Inner Query Dependency | Example Operators    | Notes                                          |
| ----------- | ---------------------- | -------------------- | ---------------------------------------------- |
| Independent | No                     | IN, NOT IN, ANY, ALL | Executes once, outer query uses results        |
| Correlated  | Yes                    | EXISTS               | Executes per outer row, references outer query |

**Tips:**

* Use **nested queries** for clarity when a query depends on another query.
* Use **joins** if performance is critical; correlated subqueries can be slower.
* Subqueries can be nested multiple levels deep, but readability decreases.

---