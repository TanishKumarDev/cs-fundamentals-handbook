
# **SQL GROUP BY**

The **`GROUP BY`** statement in SQL is used to **group rows that have the same values in one or more columns**. It is primarily used to **create summaries** such as totals, counts, or averages for each group.

It is **always used with aggregate functions** (like `SUM()`, `COUNT()`, `AVG()`, `MIN()`, `MAX()`) to summarize grouped data.

---

## **1. Key Features**

* Works **with `SELECT` statements** to summarize data.
* Groups rows **after filtering with `WHERE`**.
* Can be combined with **aggregate functions**.
* Use `HAVING` to **filter grouped results**.
* Execution order:

```
FROM -> WHERE -> GROUP BY -> HAVING -> SELECT -> ORDER BY
```

---

## **2. Syntax**

```sql
SELECT column1, aggregate_function(column2)
FROM table_name
WHERE condition
GROUP BY column1, column2;
```

* `aggregate_function`: SUM(), AVG(), COUNT(), etc.
* `table_name`: Table from which data is selected.
* `condition`: Optional filter applied before grouping.
* `column1, column2`: Columns used to group rows.

---

## **3. Example Table: Student**

```sql
CREATE TABLE student (
  name VARCHAR(50),
  year INT,
  subject VARCHAR(50)
);

INSERT INTO student (name, year, subject) VALUES
('Avery', 1, 'Mathematics'),
('Elijah', 2, 'English'),
('Harper', 3, 'Science'),
('James', 1, 'Mathematics'),
('Charlotte', 2, 'English'),
('Benjamin', 3, 'Science');
```

| name      | year | subject     |
| --------- | ---- | ----------- |
| Avery     | 1    | Mathematics |
| Elijah    | 2    | English     |
| Harper    | 3    | Science     |
| James     | 1    | Mathematics |
| Charlotte | 2    | English     |
| Benjamin  | 3    | Science     |

---

## **4. GROUP BY Single Column**

**Query:** Count students per subject

```sql
SELECT subject, COUNT(*) AS Student_Count
FROM Student
GROUP BY subject;
```

**Output:**

| subject     | Student_Count |
| ----------- | ------------- |
| English     | 2             |
| Mathematics | 2             |
| Science     | 2             |

**Logic:**

* Rows with the same subject are **grouped together**.
* `COUNT(*)` counts rows **in each group**.

---

## **5. GROUP BY Multiple Columns**

**Query:** Count students per subject per year

```sql
SELECT subject, year, COUNT(*) AS Student_Count
FROM Student
GROUP BY subject, year;
```

**Output:**

| subject     | year | Student_Count |
| ----------- | ---- | ------------- |
| English     | 2    | 2             |
| Mathematics | 1    | 2             |
| Science     | 3    | 2             |

**Logic:**

* Rows with the same **subject-year pair** are grouped.
* `COUNT(*)` counts **rows in each group**.

---

## **6. HAVING Clause**

* `HAVING` filters **aggregated results**.
* Unlike `WHERE`, it is applied **after grouping**.

**Example Table: Employee (`emp`)**

```sql
CREATE TABLE emp (
  emp_no INT PRIMARY KEY,
  name VARCHAR(50),
  sal DECIMAL(10,2),
  age INT
);

INSERT INTO emp (emp_no, name, sal, age) VALUES
(1, 'Liam', 50000.00, 25),
(2, 'Emma', 60000.50, 30),
(3, 'Noah', 75000.75, 35),
(4, 'Olivia', 45000.25, 28),
(5, 'Ethan', 80000.00, 32),
(6, 'Sophia', 65000.00, 27),
(7, 'Mason', 55000.50, 29),
(8, 'Isabella', 72000.75, 31),
(9, 'Logan', 48000.25, 26),
(10, 'Mia', 83000.00, 33);
```

---

### **6a. Filter by Total Salary**

```sql
SELECT name, SUM(sal) AS Total_Salary
FROM emp
GROUP BY name
HAVING SUM(sal) > 50000;
```

**Output:**

| name     | Total_Salary |
| -------- | ------------ |
| Emma     | 60000.50     |
| Noah     | 75000.75     |
| Ethan    | 80000.00     |
| Sophia   | 65000.00     |
| Mason    | 55000.50     |
| Isabella | 72000.75     |
| Mia      | 83000.00     |

**Logic:**

* Groups rows by `name`.
* Aggregates salaries using `SUM(sal)`.
* Only groups with total salary > 50,000 are displayed.

---

### **6b. Filter by Average Salary**

```sql
SELECT age, AVG(sal) AS Average_Salary
FROM emp
GROUP BY age
HAVING AVG(sal) > 60000;
```

**Output:**

| age | Average_Salary |
| --- | -------------- |
| 27  | 65000.00       |
| 30  | 60000.50       |
| 31  | 72000.75       |
| 32  | 80000.00       |
| 33  | 83000.00       |
| 35  | 75000.75       |

**Logic:**

* Groups rows by `age`.
* Aggregates salaries with `AVG(sal)`.
* Only groups with average salary > 60,000 are included.

---

## **7. Summary Notes**

* **`GROUP BY`**: Groups rows with the same values.
* **`HAVING`**: Filters aggregated/grouped results.
* Always used with **aggregate functions**.
* Execution order matters: `WHERE` → `GROUP BY` → `HAVING` → `SELECT`.
* Can group by **one or multiple columns**.

---
