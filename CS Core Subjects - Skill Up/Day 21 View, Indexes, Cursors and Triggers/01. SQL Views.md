# **Day 21 - SQL Views, Indexes, Cursors, Triggers**

## SQL Views

### **1. SQL Views**

#### **Definition**

A **view** is a saved SQL query that acts like a **virtual table**. It **does not store data physically** but displays data dynamically by executing the query every time itâ€™s accessed.

**Benefits of Views:**

* **Simplify Complex Queries:** Encapsulate joins and conditions.
* **Enhance Security:** Restrict access to certain columns or rows.
* **Data Presentation:** Tailor data for different users.

---

#### **2. Creating a View**

**Syntax:**

```sql
CREATE VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
WHERE condition;
```

**Example 1: Single Table View**

```sql
CREATE VIEW DetailsView AS
SELECT NAME, ADDRESS
FROM StudentDetails
WHERE S_ID < 5;

-- Fetch data from view
SELECT * FROM DetailsView;
```

**Output**

| NAME    | ADDRESS  |
| ------- | -------- |
| Harsh   | Kolkata  |
| Ashish  | Durgapur |
| Pratik  | Delhi    |
| Dhanraj | Bihar    |

---

**Example 2: View from Multiple Tables**

```sql
CREATE VIEW MarksView AS
SELECT StudentDetails.NAME, StudentDetails.ADDRESS, StudentMarks.MARKS
FROM StudentDetails, StudentMarks
WHERE StudentDetails.NAME = StudentMarks.NAME;

-- Fetch data from view
SELECT * FROM MarksView;
```

**Output**

| NAME    | ADDRESS   | MARKS |
| ------- | --------- | ----- |
| Harsh   | Kolkata   | 90    |
| Pratik  | Delhi     | 80    |
| Dhanraj | Bihar     | 95    |
| Ram     | Rajasthan | 85    |

---

#### **3. Managing Views**

1. **List all views in a database**

```sql
SHOW FULL TABLES WHERE table_type LIKE '%VIEW';

-- Or using information_schema
SELECT table_name
FROM information_schema.views
WHERE table_schema = 'database_name';
```

2. **Delete a View**

```sql
DROP VIEW MarksView;
```

3. **Update View Definition**

```sql
CREATE OR REPLACE VIEW MarksView AS
SELECT StudentDetails.NAME, StudentDetails.ADDRESS, StudentMarks.MARKS, StudentMarks.AGE
FROM StudentDetails, StudentMarks
WHERE StudentDetails.NAME = StudentMarks.NAME;
```

---

#### **4. Modifying Data Through Views**

* **Update**

```sql
UPDATE DetailsView
SET ADDRESS = 'NewCity'
WHERE NAME = 'Harsh';
```

* **Insert**

```sql
INSERT INTO DetailsView(NAME, ADDRESS)
VALUES('Suresh','Gurgaon');
```

* **Delete**

```sql
DELETE FROM DetailsView
WHERE NAME = 'Suresh';
```

> **Note:** Not all views are updatable.
> **Rules for Updatable Views:**
>
> * Must not use `GROUP BY`, `DISTINCT`, or nested queries.
> * Should include only columns with NOT NULL constraints.
> * Views created from **multiple tables** may not be directly updatable (depends on **key-preserved table** concept).

---

#### **5. WITH CHECK OPTION**

```sql
CREATE VIEW SampleView AS
SELECT S_ID, NAME
FROM StudentDetails
WHERE NAME IS NOT NULL
WITH CHECK OPTION;
```

* Prevents inserting/updating rows that **violate the view condition**.
* Example: Trying `INSERT INTO SampleView(S_ID) VALUES(6);` will fail.

---
