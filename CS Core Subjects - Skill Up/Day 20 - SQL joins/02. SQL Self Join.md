# **Day 20 - SQL Joins**

## Self Joins

### **1. Purpose**

A Self Join is used to:

* Compare rows within the same table.
* Retrieve hierarchical data (like employee-manager, parent-child, category-subcategory).
* Detect duplicates or analyze sequences.
* Find relationships within the same table.

> **Note:** Self Join is not a new join type; it’s just a table joined with itself using **aliases**.

---

### **2. Syntax**

```sql
SELECT columns
FROM table AS alias1
JOIN table AS alias2 
ON alias1.column = alias2.related_column;
```

* `columns`: columns to retrieve
* `alias1`: first reference to the table
* `alias2`: second reference to the same table
* `related_column`: the column linking rows within the same table (e.g., `Employee.ManagerID = Manager.EmployeeID`)

---

### **3. Example: Employees and Their Managers**

**Table: GFGemployees**

```sql
CREATE TABLE GFGemployees (
    employee_id INT PRIMARY KEY,
    employee_name VARCHAR(50),
    manager_id INT
);

INSERT INTO GFGemployees VALUES (1, 'Zaid', 3);
INSERT INTO GFGemployees VALUES (2, 'Rahul', 3);
INSERT INTO GFGemployees VALUES (3, 'Raman', 4);
INSERT INTO GFGemployees VALUES (4, 'Kamran', NULL);
INSERT INTO GFGemployees VALUES (5, 'Farhan', 4);
```

**Data**

| employee_id | employee_name | manager_id |
| ----------- | ------------- | ---------- |
| 1           | Zaid          | 3          |
| 2           | Rahul         | 3          |
| 3           | Raman         | 4          |
| 4           | Kamran        | NULL       |
| 5           | Farhan        | 4          |

---

### **4. Self Join Query**

```sql
SELECT e.employee_name AS employee, m.employee_name AS manager
FROM GFGemployees AS e
JOIN GFGemployees AS m
ON e.manager_id = m.employee_id;
```

**Output**

| employee | manager |
| -------- | ------- |
| Zaid     | Raman   |
| Rahul    | Raman   |
| Raman    | Kamran  |
| Farhan   | Kamran  |

> Kamran (manager_id = NULL) is not listed as an employee but appears as a manager.

---

### **5. Applications of SQL Self Join**

1. **Hierarchical Data**: Employee–manager, parent–child categories.
2. **Finding Relationships**: Social networks, task dependencies.
3. **Data Comparison**: Compare rows in the same table (e.g., salaries within a department).
4. **Detecting Duplicates**: Identify duplicate records.
5. **Sequential Analysis**: Compare previous and current rows for trends.

---

### **6. Practice File Snippet (`day21_sql_selfjoin.sql`)**

```sql
-- 1. Create Table
CREATE TABLE GFGemployees (
    employee_id INT PRIMARY KEY,
    employee_name VARCHAR(50),
    manager_id INT
);

-- 2. Insert Sample Data
INSERT INTO GFGemployees VALUES (1, 'Zaid', 3);
INSERT INTO GFGemployees VALUES (2, 'Rahul', 3);
INSERT INTO GFGemployees VALUES (3, 'Raman', 4);
INSERT INTO GFGemployees VALUES (4, 'Kamran', NULL);
INSERT INTO GFGemployees VALUES (5, 'Farhan', 4);

-- 3. Self Join: Employees with Managers
SELECT e.employee_name AS employee, m.employee_name AS manager
FROM GFGemployees AS e
JOIN GFGemployees AS m
ON e.manager_id = m.employee_id;

-- 4. Optional: Find employees with no manager
SELECT employee_name
FROM GFGemployees
WHERE manager_id IS NULL;
```