# Day 9 – Keys & Constraints

## **2: DBMS Integrity Constraints**

## **1. Introduction**

### **What are Integrity Constraints?**

Integrity constraints are **rules in a Database Management System (DBMS)** that ensure data remains **accurate, consistent, and reliable**.
They maintain **data quality** during operations like insertion, deletion, and updates, ensuring the database’s logical structure remains valid.

![](https://media.geeksforgeeks.org/wp-content/uploads/20250122170114749572/integrity_constraints.webp)

**Purpose:**

* Maintain accuracy and consistency of data
* Prevent invalid, incomplete, or inconsistent entries
* Preserve logical relationships among data

**Example:**

* Ensuring every customer has a valid email
* Making sure each order is linked to an existing customer

---

## **2. Types of Integrity Constraints**

### **Overview**

Integrity constraints are categorized into the following types:

1. Domain Constraints
2. Entity Integrity Constraints
3. Key Constraints
4. Referential Integrity Constraints
5. Assertions
6. Triggers

---

## **3. Domain Constraints**

### **Definition**

Domain constraints define the **valid values** that can be stored in a column (attribute).
They restrict data entry based on the **data type, range, or format** of that column.

**Example Table – Student:**

| Student_Id | Name             | Semester | Age |
| ---------- | ---------------- | -------- | --- |
| 21CSE100   | Aniket Kumar     | 6th      | 20  |
| 21CSE101   | Shashwat Dubey   | 7th      | 21  |
| 21CSE102   | Manvendra Sharma | 8th      | 22  |
| 21CSE103   | Ashmit Dubey     | 5th      | 20  |

### **Rules Applied**

* **Student_Id:** Must follow format like 21CSE### and be unique
* **Name:** Only text, not empty (NOT NULL)
* **Semester:** Only predefined values allowed (e.g., 5th, 6th, 7th)
* **Age:** Integer within a valid range (e.g., 18–30)

### **Types of Domain Constraints**

* **NOT NULL Constraint:** Prevents null entries
* **CHECK Constraint:** Validates a specific condition for each record

### **Why Important**

* Ensures valid and consistent data
* Maintains business rules and data integrity
* Reduces human and system errors

---

## **4. Entity Integrity Constraints**

### **Definition**

Entity integrity ensures that the **primary key of a table cannot contain NULL values**.
Every record must be uniquely identifiable.

### **Key Rules**

* **Primary Key must be unique**
* **Primary Key cannot be NULL**

**Example – Invalid Table:**

| Student_id | Name    | Semester | Age |
| ---------- | ------- | -------- | --- |
| 21CSE101   | Ramesh  | 5th      | 20  |
| 21CSE102   | Kamlesh | 5th      | 21  |
| 21CSE103   | Aakash  | 5th      | 22  |
| NULL       | Mukesh  | 5th      | 20  |

The last record violates entity integrity because the primary key (`Student_id`) is NULL.

---

## **5. Key Constraints**

### **Definition**

Key constraints ensure that certain columns (or combinations of columns) **uniquely identify each row** in a table.

### **Why Important**

* Prevents duplicate entries
* Maintains unique identification
* Enables relationship formation using foreign keys

---

### **5.1 Primary Key Constraint**

* Attributes must be **unique** and **not NULL**.
* Ensures no two tuples are identical.

**Example – Violates Primary Key:**

| Student_id | Name    | Semester | Age |
| ---------- | ------- | -------- | --- |
| 101        | Ramesh  | 5th      | 20  |
| 102        | Kamlesh | 5th      | 21  |
| 103        | Akash   | 5th      | 22  |
| 101        | Mukesh  | 5th      | 20  |

The 4th row repeats `101`, violating the **Primary Key Constraint**.

---

### **5.2 Unique Key Constraint**

* Ensures **all values** in a column are distinct.
* **Allows one NULL** value (unlike primary key).

**Example:**

| Employee_ID | Email                                               | Name             |
| ----------- | --------------------------------------------------- | ---------------- |
| 1           | [aniket@example.com](mailto:aniket@example.com)     | Aniket Kumar     |
| 2           | NULL                                                | Shashwat Dubey   |
| 3           | [shashwat@example.com](mailto:shashwat@example.com) | Manvendra Sharma |

* `Email` must be unique; duplicates are not allowed.
* One NULL is permitted, but not more.

---

## **6. Referential Integrity Constraints**

### **Definition**

Referential integrity ensures that a **foreign key in one table refers to an existing primary key** in another table or is NULL.
It maintains **logical consistency between related tables**.

### **Why Important**

* Prevents orphan records
* Ensures valid relationships
* Maintains relational consistency

**Example:**

**Student Table**

| Student_id | Name    | Semester | Block_No |
| ---------- | ------- | -------- | -------- |
| 22CSE101   | Ramesh  | 5th      | 20       |
| 21CSE105   | Kamlesh | 6th      | 21       |
| 22CSE102   | Aakash  | 5th      | 20       |
| 23CSE106   | Mukesh  | 2nd      | 22 ❌     |

**Block Table**

| Block_No | Block Location |
| -------- | -------------- |
| 20       | Chandigarh     |
| 21       | Punjab         |
| 25       | Delhi          |

The entry with `Block_No = 22` in the Student table is invalid because it doesn’t exist in the Block table.

---

## **7. Assertion**

### **Definition**

An **assertion** is a global integrity constraint applied to the **entire database**.
It ensures that certain business rules or conditions are always true across multiple tables.

### **Syntax**

```sql
CREATE ASSERTION <assertion_name>
CHECK (<predicate>);
```

### **Example**

```sql
CREATE ASSERTION sum_constraint
CHECK (
  NOT EXISTS (
    SELECT * 
    FROM branch
    WHERE (
      SELECT SUM(amount) FROM loan WHERE loan.branch_name = branch.branch_name
    ) >= (
      SELECT SUM(amount) FROM account WHERE account.branch_name = branch.branch_name
    )
  )
);
```

### **Explanation**

* Ensures total loan amount < total account balances at every branch.
* If violated, the database rejects the transaction.
* Applies globally across all branches and tables.

---

## **8. Triggers**

### **Definition**

A **trigger** is an automatic procedure executed when a specific event occurs in the database (e.g., `INSERT`, `UPDATE`, `DELETE`).
Used for **enforcing complex integrity rules** that can’t be expressed using standard constraints.

### **Example**

```sql
CREATE TRIGGER handle_overdraft
AFTER UPDATE ON account
FOR EACH ROW
BEGIN
    IF NEW.balance < 0 THEN
        UPDATE account
        SET balance = 0
        WHERE account_number = NEW.account_number;

        INSERT INTO loan (loan_number, loan_amount)
        VALUES (NEW.account_number, ABS(NEW.balance));
    END IF;
END;
```

### **Explanation**

* Trigger activates after updating the `account` table.
* If the balance becomes negative:

  * Balance is reset to zero.
  * A loan is automatically created for the overdraft amount.
* Ensures financial integrity and automates corrective actions.

---

## **9. Summary**

| Type                  | Purpose                        | Ensures                   |
| --------------------- | ------------------------------ | ------------------------- |
| Domain Constraint     | Valid data type and range      | Attribute-level validity  |
| Entity Integrity      | Unique primary key             | Each row identifiable     |
| Key Constraint        | Uniqueness across rows         | No duplicate tuples       |
| Referential Integrity | Valid foreign key references   | Relationship consistency  |
| Assertion             | Global condition validity      | Database-wide correctness |
| Trigger               | Automatic enforcement of rules | Event-driven consistency  |

---