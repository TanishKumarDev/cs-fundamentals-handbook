# System Call

## 1. What Is a System Call?

**Definition**: A **system call** is a request from a user program to the OS kernel to perform tasks requiring **privileged hardware access**, such as file creation or memory allocation.

**Why Needed?**
- **User Mode**: Applications run with restricted hardware access.
- **Kernel Mode**: The kernel has full hardware control.
- **System Call Interface (SCI)**: Bridges user and kernel modes, enabling secure access.

**Analogy**:
- **User Mode** = Restaurant customer placing an order.
- **Kernel Mode** = Chef in the kitchen preparing the order.
- **System Call** = Waiter relaying the order to the kitchen.

---

## 2. How System Calls Work

![System Call Execution](https://phoenixnap.com/kb/wp-content/uploads/2023/08/system-call-steps-execution.png)

### Step-by-Step Process
1. **User Request**: User issues a command (e.g., `mkdir Movies` in CLI or "New Folder" in GUI).
2. **Trigger SCI**: The command invokes the System Call Interface.
3. **Mode Switch**: A **software interrupt** switches the CPU from user mode to kernel mode.
4. **Kernel Execution**: The kernel executes the task (e.g., creates a folder on disk using C code).
5. **Return to User Mode**: The kernel returns a result (e.g., success message) to user space.

**Example**:
```bash
$ mkdir Movies  # User command
↓
SCI invokes `sys_mkdir()` in kernel
↓
Kernel creates folder → Returns "Success"
```

---

## 3. Types of System Calls

![Types of System Calls](https://media.geeksforgeeks.org/wp-content/uploads/20231017212555/Types-of-System-Calls-(3)-(2).png)

| **Category** | **Purpose** | **Examples (Linux/Windows)** |
|--------------|-------------|-----------------------------|
| **Process Control** | Manage process creation/termination | `fork()`, `exit()`, `wait()` |
| **File Management** | Handle file operations | `open()`, `read()`, `chmod()` |
| **Device Management** | Control hardware devices | `ioctl()`, `read()`, `write()` |
| **Information** | Retrieve system data | `getpid()`, `time()`, `alarm()` |
| **Communication** | Enable inter-process communication (IPC) | `pipe()`, `shmget()`, `mmap()` |

---

## 4. Key Examples Explained

### (A) Process Control: `fork()`
- **Purpose**: Creates a child process (clone of the parent).
- **Code**:
  ```c
  #include <unistd.h>
  #include <stdio.h>
  int main() {
      fork();  // Creates child process
      printf("Hello OS!\n");
      return 0;
  }
  ```
- **Output**:
  ```
  Hello OS!  // Parent process
  Hello OS!  // Child process
  ```

### (B) File Management: `open()` & `write()`
- **Purpose**: Creates or writes to a file.
- **Terminal Example**:
  ```bash
  $ echo "Hello" > file.txt  # Uses `open()` and `write()` system calls
  ```

### (C) Communication: `pipe()`
- **Purpose**: Creates a channel for inter-process communication (IPC).
- **Use Case**: Process A writes data to a pipe; Process B reads it.

---

## 5. Practical Demo: System Calls in Action

### Creating and Running a Script ([`Hello.sh`](http://hello.sh/))
1. **Write Script**:
   ```bash
   #!/bin/bash
   echo "Hello CodeHelp"  # Uses `write()` system call
   sleep 10              # Uses `sleep()` system call
   ```

2. **Execute Script**:
   ```bash
   $ chmod +x Hello.sh  # Uses `chmod()` system call
   $ ./Hello.sh         # Uses `fork()` and `exec()` system calls
   ```

3. **Monitor and Control**:
   ```bash
   $ ps -a              # Uses `getpid()` to list processes
   $ kill -9 [PID]      # Uses `kill()` to terminate process
   ```

---

## 6. Why System Calls Matter

1. **Security**: Prevent applications from directly accessing hardware, reducing crash or attack risks.
2. **Abstraction**: Simplify complex operations (e.g., `mkdir` abstracts disk allocation).
3. **Standardization**: Provide a uniform interface for apps to interact with the kernel.

---

## 7. Interview Questions

1. **How does `mkdir` work internally?**
   - The `mkdir` command triggers the `sys_mkdir()` system call via the SCI, which creates a folder on disk.

2. **Difference between `fork()` and `exec()`?**
   - `fork()` creates a child process (clone); `exec()` replaces the current process with a new program.

3. **What happens during a mode switch?**
   - A software interrupt saves the user mode state, switches the CPU to kernel mode, executes the system call, and returns to user mode.

---

## 8. Homework

1. **Explore System Call Documentation**:
   ```bash
   $ man 2 kill    # View `kill()` system call details
   $ man 2 open    # View `open()` system call details
   ```

2. **Trace System Calls**:
   ```bash
   $ strace ./Hello.sh  # Tracks system calls made by the script
   ```

---

## 9. Key Takeaways

1. **System Calls**: Act as a secure gateway between user applications and the kernel.
2. **Five Categories**: Process control, file management, device management, information, and communication.
3. **Real-World Impact**: Every CLI/GUI action (e.g., creating a folder, running a script) relies on system calls for kernel interaction.
