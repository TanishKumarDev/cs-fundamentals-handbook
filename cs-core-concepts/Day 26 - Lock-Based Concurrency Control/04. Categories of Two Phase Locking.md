## **Categories of Two-Phase Locking (2PL) ‚Äî DBMS**

### **Overview**

Two-Phase Locking (2PL) ensures **consistency** and **isolation** during concurrent transactions.
It guarantees **conflict serializability** by controlling how locks are **acquired and released**.

There are **3 main types of 2PL protocols**:

1. **Strict 2PL**
2. **Rigorous 2PL**
3. **Conservative 2PL**

---

## üî∏ 1. **Strict Two-Phase Locking (Strict 2PL)**

### üß† **Definition**

Strict 2PL extends the basic 2PL by adding a rule:

> ‚û§ **All Exclusive (X) locks are held until the transaction commits or aborts.**

During the **Growing Phase**: locks can be acquired.
During the **Shrinking Phase**: locks can be released only **after commit/abort** (for X-locks).

---

### ‚öôÔ∏è **Example**

**Transaction T1**

1. `lock-X(A)` ‚Üí reads A, modifies it
2. `lock-X(B)` ‚Üí reads B, modifies it
3. `commit` ‚Üí only now `unlock(A), unlock(B)`

**Transaction T2**

1. Waits if T1 still holds lock on A (prevents dirty read).
2. Reads the committed data after T1 releases the lock.

‚úÖ **Final:**
T2 reads **committed values** only after T1 completes.

---

### ‚úÖ **Advantages**

* **Recoverable schedule**: No transaction depends on uncommitted data.
* **Cascadeless schedule**: Prevents cascading rollbacks.
* **Ensures serializability.**

---

### ‚ö†Ô∏è **Limitation**

* **Deadlocks possible**, since locks are held longer.

---

## üî∏ 2. **Rigorous Two-Phase Locking (Rigorous 2PL)**

### üß† **Definition**

Rigorous 2PL is **stricter** than Strict 2PL.

> ‚û§ A transaction holds **both Shared (S)** and **Exclusive (X)** locks until it commits or aborts.

No lock (read or write) is released before commit.

---

### ‚öôÔ∏è **Example**

**T1**

1. `lock-X(A)` ‚Üí read & modify
2. `lock-X(B)` ‚Üí read & modify
3. `commit` ‚Üí only now `unlock(A), unlock(B)`

**T2**

* Must wait for T1 to **commit** before accessing A or B.
* Reads only after T1 releases locks.

---

### ‚úÖ **Advantages**

* **No Cascading Rollbacks** (since no uncommitted data is read).
* **Strict schedules guaranteed.**
* **Simpler recovery** due to consistent state visibility.

---

### ‚ö†Ô∏è **Limitation**

* Still **prone to deadlocks**.
* Reduces concurrency (since even shared locks are held till commit).

---

### ‚öñÔ∏è **Strict vs Rigorous 2PL**

| Feature                      | Strict 2PL       | Rigorous 2PL          |
| ---------------------------- | ---------------- | --------------------- |
| **Locks held until commit?** | Only **X-locks** | **S and X locks**     |
| **Cascading Rollbacks**      | Prevented        | Prevented             |
| **Concurrency**              | Higher           | Lower                 |
| **Implementation**           | Slightly complex | Easier (uniform rule) |
| **Deadlocks**                | Possible         | Possible              |

üü¢ **Rigorous ‚äÇ Strict ‚äÇ Basic 2PL**
Every **Rigorous** schedule is **Strict**, but not vice versa.

---

## üî∏ 3. **Conservative Two-Phase Locking (Conservative 2PL / Static 2PL)**

### üß† **Definition**

Conservative 2PL aims to **eliminate deadlocks**.

> ‚û§ A transaction **acquires all locks it will need before it starts executing**.

If all required locks are not available ‚Üí the transaction **waits** before starting.

---

### ‚öôÔ∏è **Example**

**T1**

1. `lock-X(A)`, `lock-X(B)` ‚Üí acquires all locks at the start
2. Performs all operations
3. `unlock(A)`, `unlock(B)` after completion

**T2**

* Tries to acquire both locks at start.
* Waits until T1 releases A and B.

---

### ‚úÖ **Advantages**

* **Deadlock-free** (no circular waiting).
* **Efficient lock usage** (no partial holds).
* **Ensures serializability** and **consistency**.

---

### ‚ö†Ô∏è **Limitation**

* May **reduce concurrency**, since transactions must **wait longer** to get all locks at once.
* Requires **knowledge of all data items** a transaction will access upfront.

---

## üß≠ **Summary Table**

| Protocol             | Locks Held Till Commit          | Deadlock Possible | Cascading Rollback | Concurrency | Notes                        |
| -------------------- | ------------------------------- | ----------------- | ------------------ | ----------- | ---------------------------- |
| **Basic 2PL**        | No                              | ‚úÖ Yes             | ‚úÖ Yes              | High        | Only ensures serializability |
| **Strict 2PL**       | X-locks                         | ‚úÖ Yes             | ‚ùå No               | Medium      | Commonly used                |
| **Rigorous 2PL**     | S & X-locks                     | ‚úÖ Yes             | ‚ùå No               | Low         | Strongest guarantee          |
| **Conservative 2PL** | All locks acquired before start | ‚ùå No              | ‚ùå No               | Medium-Low  | Deadlock-free                |

---

## üß© **Key Insights**

* All 2PL variants ensure **conflict serializability**.
* **Strict and Rigorous 2PL** prevent **cascading rollbacks**.
* **Conservative 2PL** prevents **deadlocks** completely.
* **Trade-off** = More safety ‚Üí Less concurrency.
